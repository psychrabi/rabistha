import{r as n,a as O,j as e}from"./index-BlHWBPgu.js";import{a as q,o as M,b as I,s as S,n as b,e as E,c as L}from"./types-CRCHasq1.js";import{u as V,a as R}from"./index.esm-BUY_5oYX.js";import{u as P}from"./adminStore-DDi2z0cC.js";import{F as z}from"./Filter-NLO-_H3g.js";const W=M({userId:b().min(1,"Customer is required"),items:L(M({description:S().min(1,"Description is required"),quantity:b().min(1,"Quantity must be at least 1"),price:b().min(0,"Price must be positive")})).min(1,"At least one item is required"),discount:b().min(0).default(0),discountType:E(["amount","percent"]).default("amount"),notes:S().optional(),message:S().optional(),subTotal:b().optional(),taxable:b().optional(),tax:b().optional(),total:b().optional(),validUntil:S().min(1,"Valid until date is required")});function B(x){const m=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],c=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function u(a){return a<20?m[a]:a<100?c[Math.floor(a/10)]+(a%10?"-"+m[a%10]:""):a<1e3?m[Math.floor(a/100)]+" hundred"+(a%100?" "+u(a%100):""):a<1e6?u(Math.floor(a/1e3))+" thousand"+(a%1e3?" "+u(a%1e3):""):a.toString()}const[i,h]=x.toFixed(2).split(".").map(Number);let s="";return i>0&&(s+=u(i)+(i===1?" dollar":" dollars")),h>0&&(s+=(s?" and ":"")+u(h)+(h===1?" cent":" cents")),s||(s="zero dollars"),s.charAt(0).toUpperCase()+s.slice(1)}function J(){const{users:x}=P(),[m,c]=n.useState([]),[u,i]=n.useState(""),h=O(),{register:s,handleSubmit:a,reset:T,watch:y,control:N,setValue:C,getValues:v,formState:{errors:d}}=V({resolver:q(W),defaultValues:{items:[{description:"",quantity:1,price:0}]}}),{fields:p,append:A,remove:F}=R({control:N,name:"items"}),t=y("items"),l=Number(y("discount"))||0,$=y("notes"),k=Array.isArray(t)?t.filter(r=>typeof r=="object"&&r&&"description"in r&&"quantity"in r&&"price"in r):[],g=n.useMemo(()=>k.reduce((r,o)=>r+(Number(o.quantity)||0)*(Number(o.price)||0),0),[k]),f=n.useMemo(()=>v("discountType")==="percent"?+(g*(l/100)).toFixed(2):l,[l,g]),w=Math.max(g-f,0),Q=+(w*.13).toFixed(2),j=+(w+Q).toFixed(2),U=async r=>{const o={...r,subTotal:g,taxable:w,tax:Q,total:j,price:j,validUntil:new Date(r.validUntil).toISOString()};console.log(o);try{const D=await I.request("/admin/quotes",{method:"POST",body:JSON.stringify(o)});c([...m,D]),h(0),T()}catch(D){console.error("Failed to create quote:",D)}};return n.useEffect(()=>{const r=`Total Payable: ${B(j)}`;(!j||$===u)&&(i(r),C("notes",r))},[j]),e.jsx("dialog",{className:"modal",id:"createQuotationModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[Object.keys(d).length>0&&e.jsx("ul",{children:Object.values(d).map((r,o)=>e.jsx("li",{children:r.message},o))}),e.jsxs("form",{onSubmit:a(U),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${d.userId?"select-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...s("userId",{required:!0,valueAsNumber:!0}),children:[e.jsx("option",{value:"",children:"Select customer"}),x.map(r=>e.jsxs("option",{value:r.id,children:[r.name," (",r.email,")"]},r.id))]}),d.userId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:d.userId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${d.validUntil?"input-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...s("validUntil")}),d.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:d.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),p.map((r,o)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${o}.description`)})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${o}.quantity`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${o}.price`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((Number(y(`items.${o}.quantity`))||0)*(Number(y(`items.${o}.price`))||0)).toFixed(2)]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("button",{type:"button",className:"btn btn-error btn-xs ml-2",onClick:()=>F(o),children:"Remove"})})]},r.id)),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline btn-primary btn-sm",onClick:()=>A({description:"",quantity:1,price:0}),children:"+ Add Item"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",g.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("input",{type:"number",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s("discount",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsxs("select",{className:"select block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s("discountType"),children:[e.jsx("option",{value:"amount",children:"$"}),e.jsx("option",{value:"percent",children:"%"})]})})]}),f>0&&e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount Value"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["-$",f.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",w.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Tax (13%)"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",Q.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-bold text-lg",children:["$",j.toFixed(2)]})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...s("notes")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Messages to the customer",...s("message")})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Quote"})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})}function Z(){const{quotes:x,fetchQuotes:m}=P(),[c,u]=n.useState(""),[i,h]=n.useState("all"),[s,a]=n.useState("all"),[T,y]=n.useState(1),[N]=n.useState(8),C=(x==null?void 0:x.filter(t=>{var g,f;if(c===""&&i==="all"&&s==="all")return!0;const l=c===""||((g=t.user)==null?void 0:g.name.toLowerCase().includes(c.toLowerCase()))||((f=t.user)==null?void 0:f.email.toLowerCase().includes(c.toLowerCase())),$=i==="all"||t.type===i,k=s==="all"||t.status===s;return l&&$&&k}))||[],v=T*N,d=v-N,p=C.slice(d,v),A=async t=>{try{await I.request(`/quotes/${t}/send`,{method:"POST"}),setQuotes(x.map(l=>l.id===t?{...l,status:"SENT"}:l))}catch(l){console.error("Failed to send quote:",l)}},F=async t=>{try{const l=await I.request(`/quotes/${t}/convert`,{method:"POST"});setInvoices([...invoices,l])}catch(l){console.error("Failed to convert quote:",l)}};return n.useEffect(()=>{m()},[m]),e.jsxs("section",{className:"w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-gray-100 mb-2",children:"Quotes & Invoices"}),e.jsx("p",{className:"text-slate-600 dark:text-gray-300",children:"Create and manage quotes and invoices"})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>document.getElementById("createQuotationModal").showModal(),children:"Create New Quote"}),e.jsx(J,{})]})}),e.jsx(z,{setFilterStatus:a,setSearchTerm:u,setFilterType:h,searchTerm:c,filterType:i,filterStatus:s}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg mb-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Quote #"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Customer"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Valid Until"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{children:(p==null?void 0:p.length)>0?p==null?void 0:p.map((t,l)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["QT-",t.id]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:t.user.name}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["$",t.total]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsx("div",{className:`badge ${t.status==="DRAFT"?"badge-neutral":t.status==="SENT"?"badge-info":t.status==="ACCEPTED"?"badge-success":"badge-error"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(t.validUntil).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsx("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-xs",children:"Actions"}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:[e.jsx("li",{children:e.jsx("a",{onClick:()=>A(t.id),children:"Send Quote"})}),e.jsx("li",{children:e.jsx("a",{onClick:()=>F(t.id),children:"Convert to Invoice"})}),e.jsx("li",{children:e.jsx("a",{children:"Edit"})}),e.jsx("li",{children:e.jsx("a",{children:"Download PDF"})})]})]})})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-slate-500",children:c||i!=="all"||s!=="all"?"No quotes match your filters.":"No quotes available. Add some quotes to get started."})})})]})})]})}export{Z as default};
