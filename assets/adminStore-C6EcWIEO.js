import{d as c,p as l}from"./index-C6Kg1DlB.js";const n="http://localhost:4000/api",s=c(l(r=>({isAuthenticated:!1,admin:null,token:null,licenses:[],sales:[],users:[],wikis:[],login:async e=>{try{const o=await(await fetch(`${n}/admin/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return o.token?(r({isAuthenticated:!0,admin:o.adminWithoutPassword,token:o.token}),!0):!1}catch(t){return console.error("Login failed:",t),!1}},logout:()=>{r({isAuthenticated:!1,admin:null,token:null})},fetchLicenses:async()=>{try{const e=await fetch(`${n}/admin/licenses`,{headers:{Authorization:`Bearer ${s.getState().token}`}});if(!e.ok)throw new Error("Failed to fetch licenses");const o=(await e.json()).map(a=>({...a,purchaseDate:new Date(a.purchaseDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),soldDate:a.soldDate?new Date(a.soldDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):null,lastDeactivated:a.lastDeactivated?new Date(a.lastDeactivated).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):null}));r({licenses:o})}catch(e){console.error("Error fetching licenses:",e),r({licenses:[]})}},fetchWikis:async()=>{try{const t=await(await fetch("http://localhost:4000/api/admin/wikis",{headers:{Authorization:`Bearer ${s.getState().token}`}})).json();r({wikis:t})}catch(e){console.error("Error fetching wikis:",e)}},deleteWiki:async e=>{confirm("Are you sure you want to delete this wiki?")&&(await fetch(`http://localhost:4000/api/admin/wikis/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.getState().token}`}}),fetchWikis())},fetchSales:async()=>{try{const e=await fetch(`${n}/admin/sales`,{headers:{Authorization:`Bearer ${s.getState().token}`}});if(!e.ok)throw new Error("Failed to fetch sales");const t=await e.json();r({sales:t})}catch(e){console.error("Error fetching sales:",e),r({sales:[]})}},fetchUsers:async()=>{try{const e=await fetch(`${n}/admin/users`,{headers:{Authorization:`Bearer ${s.getState().token}`}});if(!e.ok)throw new Error("Failed to fetch users");const t=await e.json();r({users:t})}catch(e){console.error("Error fetching users:",e),r({users:[]})}},revokeLicense:async e=>{try{const t=await fetch(`${n}/admin/licenses/${e}/deactivate`,{method:"POST",headers:{Authorization:`Bearer ${s.getState().token}`}});if(!t.ok)throw new Error("Failed to revoke license");(await t.json()).success&&r(a=>({licenses:a.licenses.map(i=>i.id===e?{...i,status:"deactivated"}:i)}))}catch(t){console.error("Error revoking license:",t)}},addLicense:async e=>{try{const t=await fetch(`${n}/admin/licenses`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.getState().token}`},body:JSON.stringify({licenses:e})});if(!t.ok)throw new Error("Failed to add licenses");(await t.json()).success&&await r(a=>({...a})).fetchLicenses()}catch(t){console.error("Error adding licenses:",t)}}}),{name:"admin-storage"}));export{s as u};
