import{r as d,j as e}from"./index-C1U1H91r.js";import{a as U,o as I,b as Q,s as S,n as b,e as O,c as q}from"./types-vZhvsC7k.js";import{u as E,a as L}from"./index.esm-PPw5oQXB.js";import{u as M}from"./adminStore-CYJVUMzR.js";import{F as V}from"./Filter-BQxYm-Ir.js";const R=I({userId:b().min(1,"Customer is required"),items:q(I({description:S().min(1,"Description is required"),quantity:b().min(1,"Quantity must be at least 1"),price:b().min(0,"Price must be positive")})).min(1,"At least one item is required"),discount:b().min(0).default(0),discountType:O(["amount","percent"]).default("amount"),notes:S().optional(),message:S().optional(),subtotal:b().optional(),taxable:b().optional(),tax:b().optional(),total:b().optional(),validUntil:S().min(1,"Valid until date is required")});function z(m){const p=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],u=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function x(r){return r<20?p[r]:r<100?u[Math.floor(r/10)]+(r%10?"-"+p[r%10]:""):r<1e3?p[Math.floor(r/100)]+" hundred"+(r%100?" "+x(r%100):""):r<1e6?x(Math.floor(r/1e3))+" thousand"+(r%1e3?" "+x(r%1e3):""):r.toString()}const[n,a]=m.toFixed(2).split(".").map(Number);let l="";return n>0&&(l+=x(n)+(n===1?" dollar":" dollars")),a>0&&(l+=(l?" and ":"")+x(a)+(a===1?" cent":" cents")),l||(l="zero dollars"),l.charAt(0).toUpperCase()+l.slice(1)}function W(){const{users:m}=M(),[p,u]=d.useState([]),[x,n]=d.useState(""),{register:a,handleSubmit:l,reset:r,watch:h,control:D,setValue:v,getValues:T,formState:{errors:c}}=E({resolver:U(R),defaultValues:{items:[{description:"",quantity:1,price:0}]}}),{fields:C,append:g,remove:F}=L({control:D,name:"items"}),k=h("items"),t=Number(h("discount"))||0,o=h("notes"),w=Array.isArray(k)?k.filter(s=>typeof s=="object"&&s&&"description"in s&&"quantity"in s&&"price"in s):[],y=d.useMemo(()=>w.reduce((s,i)=>s+(Number(i.quantity)||0)*(Number(i.price)||0),0),[w]),j=d.useMemo(()=>T("discountType")==="percent"?+(y*(t/100)).toFixed(2):t,[t,y]),f=Math.max(y-j,0),A=+(f*.13).toFixed(2),N=+(f+A).toFixed(2),P=async s=>{const i={...s,subtotal:y,taxable:f,tax:A,total:N,price:N,validUntil:new Date(s.validUntil).toISOString()};console.log(i);try{const $=await Q.request("/admin/quotes",{method:"POST",body:JSON.stringify(i)});u([...p,$]),setShowCreateForm(!1),r()}catch($){console.error("Failed to create quote:",$)}};return d.useEffect(()=>{const s=`Total Payable: ${z(N)}`;(!N||o===x)&&(n(s),v("notes",s))},[N]),e.jsx("dialog",{className:"modal",id:"createQuotationModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[Object.keys(c).length>0&&e.jsx("ul",{children:Object.values(c).map((s,i)=>e.jsx("li",{children:s.message},i))}),e.jsxs("form",{onSubmit:l(P),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${c.userId?"select-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...a("userId",{required:!0,valueAsNumber:!0}),children:[e.jsx("option",{value:"",children:"Select customer"}),m.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]}),c.userId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:c.userId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${c.validUntil?"input-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...a("validUntil")}),c.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:c.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),C.map((s,i)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a(`items.${i}.description`)})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a(`items.${i}.quantity`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a(`items.${i}.price`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((Number(h(`items.${i}.quantity`))||0)*(Number(h(`items.${i}.price`))||0)).toFixed(2)]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("button",{type:"button",className:"btn btn-error btn-xs ml-2",onClick:()=>F(i),children:"Remove"})})]},s.id)),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline btn-primary btn-sm",onClick:()=>g({description:"",quantity:1,price:0}),children:"+ Add Item"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",y.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("input",{type:"number",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("discount",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsxs("select",{className:"select block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("discountType"),children:[e.jsx("option",{value:"amount",children:"$"}),e.jsx("option",{value:"percent",children:"%"})]})})]}),j>0&&e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount Value"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["-$",j.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",f.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Tax (13%)"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",A.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-bold text-lg",children:["$",N.toFixed(2)]})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...a("notes")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Messages to the customer",...a("message")})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Quote"})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})}function X(){const{quotes:m,fetchQuotes:p}=M(),[u,x]=d.useState(""),[n,a]=d.useState("all"),[l,r]=d.useState("all"),[h,D]=d.useState(1),[v]=d.useState(8),T=(m==null?void 0:m.filter(t=>{var j,f;if(u===""&&n==="all"&&l==="all")return!0;const o=u===""||((j=t.user)==null?void 0:j.name.toLowerCase().includes(u.toLowerCase()))||((f=t.user)==null?void 0:f.email.toLowerCase().includes(u.toLowerCase())),w=n==="all"||t.type===n,y=l==="all"||t.status===l;return o&&w&&y}))||[],c=h*v,C=c-v,g=T.slice(C,c),F=async t=>{try{await Q.request(`/quotes/${t}/send`,{method:"POST"}),setQuotes(m.map(o=>o.id===t?{...o,status:"SENT"}:o))}catch(o){console.error("Failed to send quote:",o)}},k=async t=>{try{const o=await Q.request(`/quotes/${t}/convert`,{method:"POST"});setInvoices([...invoices,o])}catch(o){console.error("Failed to convert quote:",o)}};return d.useEffect(()=>{p()},[p]),e.jsxs("section",{className:"w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-gray-100 mb-2",children:"Quotes & Invoices"}),e.jsx("p",{className:"text-slate-600 dark:text-gray-300",children:"Create and manage quotes and invoices"})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>document.getElementById("createQuotationModal").showModal(),children:"Create New Quote"}),e.jsx(W,{})]})}),e.jsx(V,{setFilterStatus:r,setSearchTerm:x,setFilterType:a,searchTerm:u,filterType:n,filterStatus:l}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg mb-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Quote #"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Customer"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Valid Until"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{children:(g==null?void 0:g.length)>0?g==null?void 0:g.map((t,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["QT-",t.id]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:t.user.name}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["$",t.total]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsx("div",{className:`badge ${t.status==="DRAFT"?"badge-neutral":t.status==="SENT"?"badge-info":t.status==="ACCEPTED"?"badge-success":"badge-error"}`,children:t.status})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(t.validUntil).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsx("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-xs",children:"Actions"}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:[e.jsx("li",{children:e.jsx("a",{onClick:()=>F(t.id),children:"Send Quote"})}),e.jsx("li",{children:e.jsx("a",{onClick:()=>k(t.id),children:"Convert to Invoice"})}),e.jsx("li",{children:e.jsx("a",{children:"Edit"})}),e.jsx("li",{children:e.jsx("a",{children:"Download PDF"})})]})]})})]},o)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-slate-500",children:u||n!=="all"||l!=="all"?"No quotes match your filters.":"No quotes available. Add some quotes to get started."})})})]})})]})}export{X as default};
