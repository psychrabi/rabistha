import{r as l,j as e}from"./index-BLboo3h_.js";import{a as C,b as i,o as p,s as n,c as I,n as y}from"./types-Go_PBt38.js";import{u as Q}from"./index.esm-DLtw0HG-.js";import{u as q}from"./adminStore-DAZc8aLr.js";const F=p({customerId:n().min(1,"Customer is required"),items:I(p({description:n().min(1,"Description is required"),quantity:y().min(1,"Quantity must be at least 1"),price:y().min(0,"Price must be positive")})).min(1,"At least one item is required"),validUntil:n().min(1,"Valid until date is required"),notes:n().optional()});function L(){const{users:f}=q(),[c,u]=l.useState([]),[x,m]=l.useState([]),[o,h]=l.useState("quotes"),[g,b]=l.useState(!1),[N,v]=l.useState(!0),{register:a,handleSubmit:k,reset:w,watch:j,formState:{errors:t}}=Q({resolver:C(F),defaultValues:{items:[{description:"",quantity:1,price:0}]}});l.useEffect(()=>{S()},[]);const S=async()=>{try{const[s,r,d]=await Promise.all([i.request("/quotes"),i.request("/invoices")]);u(s),m(r)}catch(s){console.error("Failed to fetch data:",s)}finally{v(!1)}},D=async s=>{try{const r=await i.request("/quotes",{method:"POST",body:JSON.stringify(s)});u([...c,r]),b(!1),w()}catch(r){console.error("Failed to create quote:",r)}},T=async s=>{try{await i.request(`/quotes/${s}/send`,{method:"POST"}),u(c.map(r=>r.id===s?{...r,status:"SENT"}:r))}catch(r){console.error("Failed to send quote:",r)}},A=async s=>{try{const r=await i.request(`/quotes/${s}/convert`,{method:"POST"});m([...x,r])}catch(r){console.error("Failed to convert quote:",r)}};return N?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("span",{className:"loading loading-spinner loading-lg"})}):e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Quotes & Invoices"}),e.jsx("p",{className:"text-gray-600",children:"Create and manage quotes and invoices"})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>b(!g),children:"Create New Quote"})]}),g&&e.jsx("div",{className:"card bg-base-100 shadow-xl mb-8",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"Create New Quote"}),e.jsxs("form",{onSubmit:k(D),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{class:"text-gray-700 dark:text-gray-200",for:"siteName",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${t.customerId?"select-error":""} block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...a("customerId"),children:[e.jsx("option",{value:"",children:"Select customer"}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]}),t.customerId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.customerId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{class:"text-gray-700 dark:text-gray-200",for:"siteName",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${t.validUntil?"input-error":""} block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...a("validUntil")}),t.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:t.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.0.description")})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.0.quantity",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.0.price",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((j("items.0.quantity")||0)*(j("items.0.price")||0)).toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right  flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 ",children:e.jsx("input",{type:"text",placeholder:"Sub Total",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.subTotal")})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right  flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-2  ",children:e.jsx("input",{type:"text",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.discount")})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right  flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2  ",children:e.jsx("input",{type:"text",placeholder:"Taxable",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.taxable")})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right  flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 ",children:e.jsx("input",{type:"text",placeholder:"Taxable",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...a("items.total")})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"block w-full px-4 py-2 mt-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...a("notes")})]}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsx("button",{type:"button",className:"btn btn-ghost",onClick:()=>b(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Quote"})]})]})]})}),e.jsxs("div",{className:"tabs tabs-lifted mb-6",children:[e.jsxs("button",{className:`tab tab-lg ${o==="quotes"?"tab-active":""}`,onClick:()=>h("quotes"),children:["Quotes (",c.length,")"]}),e.jsxs("button",{className:`tab tab-lg ${o==="invoices"?"tab-active":""}`,onClick:()=>h("invoices"),children:["Invoices (",x.length,")"]})]}),o==="quotes"&&e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"All Quotes"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Quote #"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Valid Until"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:c.map(s=>{var r,d;return e.jsxs("tr",{children:[e.jsxs("td",{className:"font-mono",children:["QT-",s.id.slice(-6)]}),e.jsxs("td",{children:[(r=s.customer)==null?void 0:r.firstName," ",(d=s.customer)==null?void 0:d.lastName]}),e.jsxs("td",{children:["$",s.totalAmount]}),e.jsx("td",{children:e.jsx("div",{className:`badge ${s.status==="DRAFT"?"badge-neutral":s.status==="SENT"?"badge-info":s.status==="ACCEPTED"?"badge-success":"badge-error"}`,children:s.status})}),e.jsx("td",{children:new Date(s.validUntil).toLocaleDateString()}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsx("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-xs",children:"Actions"}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:[e.jsx("li",{children:e.jsx("a",{onClick:()=>T(s.id),children:"Send Quote"})}),e.jsx("li",{children:e.jsx("a",{onClick:()=>A(s.id),children:"Convert to Invoice"})}),e.jsx("li",{children:e.jsx("a",{children:"Edit"})}),e.jsx("li",{children:e.jsx("a",{children:"Download PDF"})})]})]})})]},s.id)})})]})})]})}),o==="invoices"&&e.jsx("div",{className:"card bg-base-100 shadow-xl",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h2",{className:"card-title",children:"All Invoices"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Invoice #"}),e.jsx("th",{children:"Customer"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Due Date"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:x.map(s=>{var r,d;return e.jsxs("tr",{children:[e.jsxs("td",{className:"font-mono",children:["INV-",s.id.slice(-6)]}),e.jsxs("td",{children:[(r=s.customer)==null?void 0:r.firstName," ",(d=s.customer)==null?void 0:d.lastName]}),e.jsxs("td",{children:["$",s.totalAmount]}),e.jsx("td",{children:e.jsx("div",{className:`badge ${s.status==="DRAFT"?"badge-neutral":s.status==="SENT"?"badge-info":s.status==="PAID"?"badge-success":"badge-error"}`,children:s.status})}),e.jsx("td",{children:new Date(s.dueDate).toLocaleDateString()}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("div",{className:"dropdown dropdown-end",children:[e.jsx("div",{tabIndex:0,role:"button",className:"btn btn-ghost btn-xs",children:"Actions"}),e.jsxs("ul",{tabIndex:0,className:"dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52",children:[e.jsx("li",{children:e.jsx("a",{children:"Send Invoice"})}),e.jsx("li",{children:e.jsx("a",{children:"Mark as Paid"})}),e.jsx("li",{children:e.jsx("a",{children:"Download PDF"})}),e.jsx("li",{children:e.jsx("a",{children:"Send Reminder"})})]})]})})]},s.id)})})]})})]})})]})}export{L as default};
