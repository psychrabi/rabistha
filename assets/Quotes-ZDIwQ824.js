import{r as x,a as U,j as e}from"./index-CkiWKD07.js";import{a as I,o as M,b as L,s as F,n as y,e as V,c as O}from"./types-BClgtdvQ.js";import{u as R,a as z}from"./index.esm-DLb5TJ9J.js";import{u as P}from"./adminStore-DIScB4fo.js";import{F as B}from"./Filter-5TjaCFDA.js";import{P as W}from"./Pagination-CY3MAsS6.js";import{X as G}from"./x-4nG_KH6H.js";import{E as J}from"./eye-BpYwshBP.js";const K=M({userId:y().min(1,"Customer is required"),items:O(M({description:F().min(1,"Description is required"),quantity:y().min(1,"Quantity must be at least 1"),price:y().min(0,"Price must be positive")})).min(1,"At least one item is required"),discount:y().min(0).default(0),discountType:V(["amount","percent"]).default("amount"),notes:F().optional(),message:F().optional(),subTotal:y().optional(),taxable:y().optional(),tax:y().optional(),total:y().optional(),validUntil:F().min(1,"Valid until date is required")});function X(t){const m=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],o=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function n(r){return r<20?m[r]:r<100?o[Math.floor(r/10)]+(r%10?"-"+m[r%10]:""):r<1e3?m[Math.floor(r/100)]+" hundred"+(r%100?" "+n(r%100):""):r<1e6?n(Math.floor(r/1e3))+" thousand"+(r%1e3?" "+n(r%1e3):""):r.toString()}const[d,u]=t.toFixed(2).split(".").map(Number);let s="";return d>0&&(s+=n(d)+(d===1?" dollar":" dollars")),u>0&&(s+=(s?" and ":"")+n(u)+(u===1?" cent":" cents")),s||(s="zero dollars"),s.charAt(0).toUpperCase()+s.slice(1)}function H(){const{users:t}=P(),[m,o]=x.useState([]),[n,d]=x.useState(""),u=U(),{register:s,handleSubmit:r,reset:j,watch:i,control:p,setValue:$,getValues:A,formState:{errors:h}}=R({resolver:I(K),defaultValues:{items:[{description:"",quantity:1,price:0}]}}),{fields:w,append:C,remove:g}=z({control:p,name:"items"}),S=i("items"),l=Number(i("discount"))||0,b=i("notes"),T=Array.isArray(S)?S.filter(a=>typeof a=="object"&&a&&"description"in a&&"quantity"in a&&"price"in a):[],f=x.useMemo(()=>T.reduce((a,c)=>a+(Number(c.quantity)||0)*(Number(c.price)||0),0),[T]),v=x.useMemo(()=>A("discountType")==="percent"?+(f*(l/100)).toFixed(2):l,[l,f]),N=Math.max(f-v,0),D=+(N*.13).toFixed(2),k=+(N+D).toFixed(2),E=async a=>{const c={...a,subTotal:f,taxable:N,tax:D,total:k,price:k,validUntil:new Date(a.validUntil).toISOString()};console.log(c);try{const Q=await L.request("/admin/quotes",{method:"POST",body:JSON.stringify(c)});o([...m,Q]),u(0),j()}catch(Q){console.error("Failed to create quote:",Q)}};return x.useEffect(()=>{const a=`Total Payable: ${X(k)}`;(!k||b===n)&&(d(a),$("notes",a))},[k]),e.jsx("dialog",{className:"modal",id:"createQuotationModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[Object.keys(h).length>0&&e.jsx("ul",{children:Object.values(h).map((a,c)=>e.jsx("li",{children:a.message},c))}),e.jsxs("form",{onSubmit:r(E),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${h.userId?"select-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...s("userId",{required:!0,valueAsNumber:!0}),children:[e.jsx("option",{value:"",children:"Select customer"}),t.map(a=>e.jsxs("option",{value:a.id,children:[a.name," (",a.email,")"]},a.id))]}),h.userId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:h.userId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${h.validUntil?"input-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...s("validUntil")}),h.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:h.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),w.map((a,c)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${c}.description`)})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${c}.quantity`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s(`items.${c}.price`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((Number(i(`items.${c}.quantity`))||0)*(Number(i(`items.${c}.price`))||0)).toFixed(2)]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("button",{type:"button",className:"btn btn-error btn-xs ml-2",onClick:()=>g(c),children:"Remove"})})]},a.id)),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline btn-primary btn-sm",onClick:()=>C({description:"",quantity:1,price:0}),children:"+ Add Item"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",f.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("input",{type:"number",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s("discount",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsxs("select",{className:"select block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...s("discountType"),children:[e.jsx("option",{value:"amount",children:"$"}),e.jsx("option",{value:"percent",children:"%"})]})})]}),v>0&&e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount Value"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["-$",v.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",N.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Tax (13%)"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",D.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-bold text-lg",children:["$",k.toFixed(2)]})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...s("notes")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Messages to the customer",...s("message")})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Quote"})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})}const Y=({quote:t})=>{var m,o,n,d,u,s,r,j;return e.jsx("dialog",{id:"quotationModal",className:"modal",children:e.jsxs("div",{className:"modal-box w-[40vw] max-w-5xl h-[95vh] overflow-y-auto relative",children:[e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"absolute top-4 right-4 text-gray-400 hover:text-gray-700",children:e.jsx(G,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"border-b pb-8 mb-8 flex items-center",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex",children:[e.jsx("img",{className:"w-auto h-7 mb-8 mr-4",src:"https://merakiui.com/images/logo.svg",alt:""})," ASTER Nepal"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-200",children:"149 Samakhushi Marg, Thamel Kathmandu"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-200",children:"Phone: +9779813098760"}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-200",children:"Email: contact@company.com"})]}),e.jsx("h1",{className:"text-4xl font-bold text-slate-400 uppercase flex-1 text-right",children:"Quotation"})]}),e.jsxs("div",{className:"pb-4 mb-4 flex items-start",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"font-semibold text-slate-700 dark:text-slate-400",children:"Prepared To:"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-100 text-xl font-semibold",children:(m=t.user)==null?void 0:m.name}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:(o=t.user)==null?void 0:o.address}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:[(n=t.user)==null?void 0:n.city,", ",(d=t.user)==null?void 0:d.country]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:["Phone: ",(u=t.user)==null?void 0:u.contact]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:["Email: ",(s=t.user)==null?void 0:s.email]})]}),e.jsxs("div",{className:"mb-4 text-right flex-1",children:[e.jsxs("p",{className:"text-2xl text-slate-500 dark:text-slate-300",children:["Quote #: ",t.id]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:["Date: ",new Date(t.createdAt).toLocaleDateString()]}),e.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-300",children:["Validity till: ",new Date(t.validUntil).toLocaleDateString()]})]})]}),e.jsx("div",{className:"divider "}),e.jsxs("div",{className:"min-h-[300px] overflow-y-auto",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Items"}),e.jsxs("table",{className:"min-w-full mb-20 table-auto ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border border-gray-700 dark:border-gray-700 bg-gray-700",children:[e.jsx("th",{className:"text-left px-4 py-2",children:"Description"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Qty"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Unit Price"}),e.jsx("th",{className:"text-right px-4 py-2",children:"Total"})]})}),e.jsxs("tbody",{children:[(r=t.items)==null?void 0:r.map((i,p)=>e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-700 px-4 py-1",children:i.description||i.name}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:i.quantity}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:i.price}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:i.price&&i.quantity?`$${(i.price*i.quantity).toFixed(2)}`:""})]},p)),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"border border-gray-700 px-4 py-1 font-semibold text-right",children:"Subtotal"}),e.jsxs("td",{className:"border border-gray-700 px-4 py-1 text-right",children:["$",(j=t.items)==null?void 0:j.reduce((i,p)=>i+p.price*p.quantity,0).toFixed(2)]})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"border border-gray-700 px-4 py-1 font-semibold text-right",children:"Discount"}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:t.discount?t.discountType==="percent"?`-${(t.subTotal*t.discount/100).toFixed(2)}`:`-${t.discount.toFixed(2)}`:null})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"border border-gray-700 px-4 py-1 font-semibold text-right",children:"Taxable"}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:t.taxable?`${t.taxable.toFixed(2)}`:"0.00"})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"border border-gray-700 px-4 py-1 font-semibold text-right",children:"Tax (Tax)"}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:t.tax?`${t.tax.toFixed(2)}`:"0.00"})]}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"border border-gray-700 px-4 py-1 font-semibold text-right",children:"Tax (Tax)"}),e.jsx("td",{className:"border border-gray-700 px-4 py-1 text-right",children:t.total?`${t.total.toFixed(2)}`:"0.00"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes"}),e.jsx("p",{children:t.notes})]}),e.jsxs("div",{className:`${t.message?"":"hidden"}`,children:[e.jsx("label",{className:"label",children:"Message"}),e.jsx("p",{children:t.message})]})]}),e.jsxs("div",{className:"mt-6 text-right text-gray-500 text-xs",children:["Generated on ",new Date().toLocaleString()]})]})})};function le(){const{quotes:t,fetchQuotes:m}=P(),[o,n]=x.useState(""),[d,u]=x.useState("all"),[s,r]=x.useState("all"),[j,i]=x.useState(1),[p]=x.useState(8),[$,A]=x.useState([]),h=(t==null?void 0:t.filter(l=>{var v,N;if(o===""&&d==="all"&&s==="all")return!0;const b=o===""||((v=l.user)==null?void 0:v.name.toLowerCase().includes(o.toLowerCase()))||((N=l.user)==null?void 0:N.email.toLowerCase().includes(o.toLowerCase())),T=d==="all"||l.type===d,f=s==="all"||l.status===s;return b&&T&&f}))||[],w=j*p,C=w-p,g=h.slice(C,w),S=l=>{A(l);const b=document.getElementById("quotationModal");b&&b.showModal()};return x.useEffect(()=>{m()},[m]),e.jsxs("section",{className:"w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-gray-100 mb-2",children:"Quotes & Invoices"}),e.jsx("p",{className:"text-slate-600 dark:text-gray-300",children:"Create and manage quotes and invoices"})]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>document.getElementById("createQuotationModal").showModal(),children:"Create New Quote"}),e.jsx(H,{})]})}),e.jsx(B,{setFilterStatus:r,setSearchTerm:n,setFilterType:u,searchTerm:o,filterType:d,filterStatus:s}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg mb-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Quote #"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Customer"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Amount"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Valid Until"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Created"}),e.jsx("th",{scope:"col",className:"px-4 py-3.5 text-sm font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{children:(g==null?void 0:g.length)>0?g==null?void 0:g.map((l,b)=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["QT-",l.id]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:l.user.name}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:["$",l.total]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsx("div",{className:`badge ${l.status==="DRAFT"?"badge-secondary":l.status==="SENT"?"badge-info":l.status==="ACCEPTED"?"badge-success":"badge-error"}`,children:l.status})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(l.validUntil).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:new Date(l.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 text-sm text-gray-500 dark:text-gray-300 whitespace-nowrap",children:e.jsx("button",{className:"text-blue-600 hover:underline",onClick:()=>S(l),children:e.jsx(J,{className:"inline"})})})]},b)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-8 text-slate-500",children:o||d!=="all"||s!=="all"?"No quotes match your filters.":"No quotes available. Add some quotes to get started."})})})]})}),e.jsx(W,{total:g.length,perPage:p,currentPage:j,onPageChange:i}),e.jsx(Y,{quote:$})]})}export{le as default};
