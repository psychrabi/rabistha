import{r as x,a as I,j as e}from"./index-BwVAqFv_.js";import{a as Q,o as T,b as O,s as g,n as o,e as V,c as P}from"./types-B6Sgu914.js";import{u as E,a as z}from"./index.esm-BEWobnSE.js";import{u as R}from"./adminStore-DheM1SjR.js";const W=T({userId:o().min(1,"Customer is required"),items:P(T({description:g().min(1,"Description is required"),quantity:o().min(1,"Quantity must be at least 1"),price:o().min(0,"Price must be positive")})).min(1,"At least one item is required"),discount:o().min(0).default(0),discountType:V(["amount","percent"]).default("amount"),notes:g().optional(),message:g().optional(),subTotal:o().optional(),taxable:o().optional(),tax:o().optional(),total:o().optional(),validUntil:g().min(1,"Valid until date is required")});function J(f){const c=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],y=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function l(t){return t<20?c[t]:t<100?y[Math.floor(t/10)]+(t%10?"-"+c[t%10]:""):t<1e3?c[Math.floor(t/100)]+" hundred"+(t%100?" "+l(t%100):""):t<1e6?l(Math.floor(t/1e3))+" thousand"+(t%1e3?" "+l(t%1e3):""):t.toString()}const[d,u]=f.toFixed(2).split(".").map(Number);let r="";return d>0&&(r+=l(d)+(d===1?" dollar":" dollars")),u>0&&(r+=(r?" and ":"")+l(u)+(u===1?" cent":" cents")),r||(r="zero dollars"),r.charAt(0).toUpperCase()+r.slice(1)}function K(){const{users:f}=R(),[c,y]=x.useState([]),[l,d]=x.useState(""),u=I(),{register:r,handleSubmit:t,reset:q,watch:m,control:S,setValue:A,getValues:$,formState:{errors:i}}=E({resolver:Q(W),defaultValues:{items:[{description:"",quantity:1,price:0}]}}),{fields:F,append:M,remove:U}=z({control:S,name:"items"}),k=m("items"),h=Number(m("discount"))||0,C=m("notes"),w=Array.isArray(k)?k.filter(s=>typeof s=="object"&&s&&"description"in s&&"quantity"in s&&"price"in s):[],b=x.useMemo(()=>w.reduce((s,a)=>s+(Number(a.quantity)||0)*(Number(a.price)||0),0),[w]),j=x.useMemo(()=>$("discountType")==="percent"?+(b*(h/100)).toFixed(2):h,[h,b]),p=Math.max(b-j,0),N=+(p*.13).toFixed(2),n=+(p+N).toFixed(2),D=async s=>{const a={...s,subTotal:b,taxable:p,tax:N,total:n,price:n,validUntil:new Date(s.validUntil).toISOString()};console.log(a);try{const v=await O.request("/admin/quotes",{method:"POST",body:JSON.stringify(a)});y([...c,v]),u(0),q()}catch(v){console.error("Failed to create quote:",v)}};return x.useEffect(()=>{const s=`Total Payable: ${J(n)}`;(!n||C===l)&&(d(s),A("notes",s))},[n]),e.jsx("dialog",{className:"modal",id:"createQuotationModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[Object.keys(i).length>0&&e.jsx("ul",{children:Object.values(i).map((s,a)=>e.jsx("li",{children:s.message},a))}),e.jsxs("form",{onSubmit:t(D),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${i.userId?"select-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...r("userId",{required:!0,valueAsNumber:!0}),children:[e.jsx("option",{value:"",children:"Select customer"}),f.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]}),i.userId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:i.userId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${i.validUntil?"input-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...r("validUntil")}),i.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:i.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),F.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.description`)})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.quantity`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.price`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((Number(m(`items.${a}.quantity`))||0)*(Number(m(`items.${a}.price`))||0)).toFixed(2)]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("button",{type:"button",className:"btn btn-error btn-xs ml-2",onClick:()=>U(a),children:"Remove"})})]},s.id)),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline btn-primary btn-sm",onClick:()=>M({description:"",quantity:1,price:0}),children:"+ Add Item"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",b.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("input",{type:"number",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r("discount",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsxs("select",{className:"select block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r("discountType"),children:[e.jsx("option",{value:"amount",children:"$"}),e.jsx("option",{value:"percent",children:"%"})]})})]}),j>0&&e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount Value"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["-$",j.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",p.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Tax (13%)"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",N.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-bold text-lg",children:["$",n.toFixed(2)]})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...r("notes")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Messages to the customer",...r("message")})]})]}),e.jsx("div",{className:"card-actions justify-end",children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Create Quote"})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})}export{K as default};
