import{r as g,a as Q,j as e}from"./index-e1O8DFM-.js";import{a as z,o as $,s as y,n,e as R,b as E}from"./types-BykIe17z.js";import{u as W,a as B}from"./index.esm-CmTGpMcZ.js";import{u as J}from"./adminStore-CKTYUQQN.js";const L=$({userId:n().min(1,"Customer is required"),items:E($({description:y().min(1,"Description is required"),quantity:n().min(1,"Quantity must be at least 1"),price:n().min(0,"Price must be positive")})).min(1,"At least one item is required"),discount:n().min(0).default(0),discountType:R(["amount","percent"]).default("amount"),notes:y().optional(),message:y().optional(),subTotal:n().optional(),taxable:n().optional(),tax:n().optional(),total:n().optional(),validUntil:y().min(1,"Valid until date is required")});function G(t){if(!t)return"";const o=new Date(t),c=o.getTimezoneOffset()*6e4;return new Date(o-c).toISOString().slice(0,10)}function H(t){const o=["zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],c=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function d(r){return r<20?o[r]:r<100?c[Math.floor(r/10)]+(r%10?"-"+o[r%10]:""):r<1e3?o[Math.floor(r/100)]+" hundred"+(r%100?" "+d(r%100):""):r<1e6?d(Math.floor(r/1e3))+" thousand"+(r%1e3?" "+d(r%1e3):""):r.toString()}const[m,b]=t.toFixed(2).split(".").map(Number);let i="";return m>0&&(i+=d(m)+(m===1?" dollar":" dollars")),b>0&&(i+=(i?" and ":"")+d(b)+(b===1?" cent":" cents")),i||(i="zero dollars"),i.charAt(0).toUpperCase()+i.slice(1)}function _({quote:t,onClose:o}){var T;const c=g.useRef(null),{users:d,token:m}=J(),[b,i]=g.useState("");Q();const{register:r,handleSubmit:A,reset:S,watch:p,control:F,setValue:U,getValues:I,formState:{errors:l}}=W({resolver:z(L),defaultValues:t?{...t,validUntil:G(t.validUntil),items:((T=t.items)==null?void 0:T.map(s=>({...s,quantity:Number(s.quantity),price:Number(s.price)})))||[]}:{}}),{fields:D,append:M,remove:C}=B({control:F,name:"items"}),k=p("items"),h=Number(p("discount"))||0,O=p("notes"),w=Array.isArray(k)?k.filter(s=>typeof s=="object"&&s&&"description"in s&&"quantity"in s&&"price"in s):[],x=g.useMemo(()=>w.reduce((s,a)=>s+(Number(a.quantity)||0)*(Number(a.price)||0),0),[w]),j=g.useMemo(()=>I("discountType")==="percent"?+(x*(h/100)).toFixed(2):h,[h,x]),f=Math.max(x-j,0),N=+(f*.13).toFixed(2),u=+(f+N).toFixed(2),q=async s=>{const a=t&&t.id?"PUT":"POST",V=t&&t.id?`http://localhost:4000/api/admin/quotes/${t.id}`:"http://localhost:4000/api/admin/quotes",P={...s,userId:Number(t.userId),subTotal:x,taxable:f,tax:N,total:u,price:u,validUntil:new Date(s.validUntil).toISOString()};try{const v=await fetch(V,{method:a,headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(P)});S({quote:v})}catch(v){console.error("Failed to create quote:",v)}finally{window.location.reload()}};return g.useEffect(()=>{c.current&&c.current.showModal();const s=`Total Payable: ${H(u)}`;(!u||O===b)&&(i(s),U("notes",s))},[u]),e.jsx("dialog",{ref:c,id:"createQuotationModal",className:"modal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[Object.keys(l).length>0&&e.jsx("ul",{children:Object.values(l).map((s,a)=>e.jsx("li",{children:s.message},a))}),e.jsxs("form",{onSubmit:A(q),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Customer's Name"}),e.jsxs("select",{className:`select select-bordered ${l.userId?"select-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...r("userId",{required:!0,valueAsNumber:!0}),children:[e.jsx("option",{value:"",children:"Select customer"}),d.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.email,")"]},s.id))]}),l.userId&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.userId.message})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-200",children:"Valid Until"}),e.jsx("input",{type:"date",className:`input input-bordered ${l.validUntil?"input-error":""} mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring`,...r("validUntil")}),l.validUntil&&e.jsx("label",{className:"label",children:e.jsx("span",{className:"label-text-alt text-error",children:l.validUntil.message})})]})]}),e.jsx("div",{className:"divider",children:"Quote Items"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-4 font-semibold",children:[e.jsx("div",{className:"col-span-6",children:"Description"}),e.jsx("div",{className:"col-span-2",children:"Quantity"}),e.jsx("div",{className:"col-span-2",children:"Price"}),e.jsx("div",{className:"col-span-2",children:"Total"})]}),D.map((s,a)=>e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-6",children:e.jsx("input",{type:"text",placeholder:"Product description",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.description`)})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.quantity`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-2",children:e.jsx("input",{type:"number",step:"0.01",className:"block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r(`items.${a}.price`,{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsxs("span",{className:"text-lg font-semibold",children:["$",((Number(p(`items.${a}.quantity`))||0)*(Number(p(`items.${a}.price`))||0)).toFixed(2)]})}),e.jsx("div",{className:"col-span-1 flex items-center",children:e.jsx("button",{type:"button",className:"btn btn-error btn-xs ml-2",onClick:()=>C(a),children:"Remove"})})]},s.id)),e.jsx("div",{children:e.jsx("button",{type:"button",className:"btn btn-outline btn-primary btn-sm",onClick:()=>M({description:"",quantity:1,price:0}),children:"+ Add Item"})}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Sub Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",x.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount"}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsx("input",{type:"number",placeholder:"Discount",className:"block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r("discount",{valueAsNumber:!0})})}),e.jsx("div",{className:"col-span-1 flex items-center gap-2",children:e.jsxs("select",{className:"select block w-full px-4 py-2 text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",...r("discountType"),children:[e.jsx("option",{value:"amount",children:"$"}),e.jsx("option",{value:"percent",children:"%"})]})})]}),j>0&&e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Discount Value"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["-$",j.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Taxable"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",f.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Tax (13%)"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-semibold",children:["$",N.toFixed(2)]})})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4",children:[e.jsx("div",{className:"col-span-8"}),e.jsx("div",{className:"col-span-2 text-right flex items-center justify-end",children:"Total"}),e.jsx("div",{className:"col-span-2 flex items-center",children:e.jsxs("span",{className:"font-bold text-lg",children:["$",u.toFixed(2)]})})]})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Notes (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Additional notes or terms",...r("notes")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Message (Optional)"}),e.jsx("textarea",{className:"mt-2 block w-full px-4 py-2  text-gray-700 bg-white border border-gray-200 rounded-md dark:bg-gray-800 dark:text-gray-300 dark:border-gray-600 focus:border-blue-400 focus:ring-blue-300 focus:ring-opacity-40 dark:focus:border-blue-300 focus:outline-none focus:ring",placeholder:"Messages to the customer",...r("message")})]})]}),e.jsxs("div",{className:"card-actions justify-end",children:[e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[t?"Update":"Create"," Quotation"]}),e.jsx("button",{className:"btn btn-secondary",onClick:o,children:"Close"})]})]})]})})}export{_ as default};
