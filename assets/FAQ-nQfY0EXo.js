import{r as n,a as E,j as e,b as T,p as Q}from"./index-TPnzWnce.js";import{J as C}from"./jodit-react-BC7XpgN_.js";import{u as P,C as M}from"./index.esm-_6oSPjYL.js";import{u as y}from"./adminStore-Bsd_0KLZ.js";import{F as $}from"./Filter-psYszsYY.js";import{P as L}from"./Pagination-DS4DXqF1.js";import{P as B}from"./plus-BlXKrtCs.js";import{P as z}from"./pencil-Blp6BNr7.js";import{T as O}from"./trash-2-D9Y4E6D7.js";const R=({currentFAQ:t})=>{const c=n.useRef(null),s=n.useRef(null),{register:o,handleSubmit:l,control:i,reset:f}=P({defaultValues:{currentFAQ:t}}),{token:d}=y(),b=E(),h=n.useMemo(()=>({readonly:!1,height:600,uploader:{url:"http://localhost:4000/api/admin/faq/upload",headers:{Authorization:`Bearer ${d}`},defaultHandlerSuccess:a=>a.file?a.file.url:null,process:a=>({files:[a.file],error:a.error?[a.error]:[]})},toolbarAdaptive:!1,buttons:["source","|","bold","italic","underline","strikethrough","|","ul","ol","|","indent","outdent","|","font","fontsize","brush","paragraph","|","image","file","table","link","|","align","undo","redo","|","hr","eraser","fullsize"],events:{beforeImage:a=>(a.style.maxWidth="100%",a.style.height="auto",a)},style:{color:"#000"}}),[]),w=async a=>{try{const m=t?"PUT":"POST",u=t?`http://localhost:4000/api/admin/faqs/${t.id}`:"http://localhost:4000/api/admin/faqs",x=await fetch(u,{method:m,headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify(a)});x.status===200&&(console.log(x),b(0))}catch(m){console.error("Error saving faq:",m)}};return n.useEffect(()=>{console.log(t),t&&f({question:t.question,answer:t.answer,category:t.category}),s.current&&s.current.showModal()},[t,f]),e.jsx("dialog",{className:"modal",id:"addFAQModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[e.jsxs("form",{onSubmit:l(w),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Title"}),e.jsx("input",{...o("question",{required:"Title is required"}),className:"w-full px-3 py-2 border rounded",placeholder:"Enter faq question"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Content"}),e.jsx(M,{name:"answer",control:i,rules:{required:"Content is required"},render:({field:{onChange:a,value:m}})=>e.jsx(C,{ref:c,theme:"dark",value:m,config:h,onChange:a})})]}),e.jsx("div",{className:"modal-action",children:e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:[t?"Update":"Create"," FAQ"]})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})},g="http://localhost:4000",U=T(Q((t,c)=>({faqs:[],loading:!1,error:null,fetchFAQs:async()=>{t({loading:!0,error:null});try{const s=await fetch(`${g}/api/faqs`);if(!s.ok)throw new Error("Failed to fetch FAQs");const o=await s.json();t({faqs:Array.isArray(o)?o:[],loading:!1})}catch(s){t({error:s.message,loading:!1})}},addFAQ:async s=>{const o=y.getState().token;try{if(!(await fetch(`${g}/api/admin/faqs`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(s)})).ok)throw new Error("Failed to add FAQ");await c().fetchFAQs()}catch(l){t({error:l.message})}},updateFAQ:async(s,o)=>{const l=y.getState().token;try{if(!(await fetch(`${g}/api/admin/faqs/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify(o)})).ok)throw new Error("Failed to update FAQ");await c().fetchFAQs()}catch(i){t({error:i.message})}},deleteFAQ:async s=>{const o=y.getState().token;try{if(confirm("Are you sure you want to delete this faq?")){if(!(await fetch(`${g}/api/admin/faqs/${s.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}})).ok)throw new Error("Failed to delete FAQ");await c().fetchFAQs()}}catch(l){t({error:l.message})}}}),{name:"faq-store"}));function X(){const{faqs:t,fetchFAQs:c,deleteFAQ:s}=U(),[o,l]=n.useState([]),[i,f]=n.useState(""),[d,b]=n.useState("all"),[h,w]=n.useState("all"),[a,m]=n.useState(1),[u]=n.useState(12),x=()=>{l(null),document.getElementById("addFAQModal").showModal()},A=r=>{l(r),document.getElementById("addFAQModal").showModal()},N=(Array.isArray(t)?t:[]).filter(r=>{if(i===""&&d==="all"&&h==="all")return!0;const v=i===""||r.question.toLowerCase().includes(i.toLowerCase()),F=d==="all"||r.type===d,q=h==="all"||r.status===h;return v&&F&&q})||[],j=a*u,k=j-u,p=N.slice(k,j),S=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return n.useEffect(()=>{c(),console.log(t)},[]),e.jsxs("section",{className:"w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-gray-100 mb-2",children:"FAQ Management"}),e.jsx("p",{className:"text-slate-600 dark:text-gray-300",children:"Manage ASTER FAQs from here"})]}),e.jsxs("button",{type:"button",onClick:()=>x(),className:"flex items-center justify-center w-1/2 px-5 py-2 text-sm tracking-wide text-white transition-colors duration-200 bg-blue-500 rounded-lg sm:w-auto gap-x-2 hover:bg-blue-600 dark:hover:bg-blue-500 dark:bg-blue-600",children:[e.jsx(B,{className:"w-5 h-5"}),e.jsx("span",{children:"Add a new FAQ"})]}),e.jsx(R,{currentFAQ:o})]})}),e.jsx($,{setFilterStatus:w,setSearchTerm:f,setFilterType:b,searchTerm:i,filterType:d,filterStatus:h}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-gray-700 md:rounded-lg mb-4",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800 text-sm",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3.5 font-normal text-left rtl:text-right text-gray-500 dark:text-gray-400",children:"Title"}),e.jsx("th",{scope:"col",className:"w-32 px-4 py-3.5 font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400",children:"Last Updated"}),e.jsx("th",{scope:"col",className:"w-32 px-4 py-3.5 font-normal text-center rtl:text-right text-gray-500 dark:text-gray-400",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200 dark:divide-gray-700 dark:bg-gray-900 text-gray-900 dark:text-gray-100",children:p.length>0?p==null?void 0:p.map(r=>e.jsxs("tr",{className:"text-sm",children:[e.jsx("td",{className:"px-4 py-2 whitespace-nowrap font-medium",children:r.question}),e.jsx("td",{className:"px-4 py-2 whitespace-nowrap text-center",children:S(r.updatedAt)}),e.jsxs("td",{className:"px-4 py-2 whitespace-nowrap font-medium",children:[e.jsx("button",{onClick:()=>A(r),className:"text-yellow-600 hover:text-yellow-900 m-2 ",children:e.jsx(z,{})}),e.jsx("button",{onClick:()=>s(r),className:"text-red-600 hover:text-red-900 m-2",children:e.jsx(O,{})})]})]},r.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-slate-500",children:i||d!=="all"||h!=="all"?"No faqs match your filters.":"No faqs available. Add some faqs to get started."})})})]})}),e.jsx(L,{perPage:u,currentPage:a,setCurrentPage:m,total:t.length})]})}export{X as default};
