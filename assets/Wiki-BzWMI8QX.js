import{r as l,a as C,j as e}from"./index-BLboo3h_.js";import{J as M}from"./jodit-react-DhjiYb-j.js";import{u as T,C as A}from"./index.esm-DLtw0HG-.js";import{u as y}from"./adminStore-DAZc8aLr.js";import{F as E}from"./Filter-DMHlpuGc.js";import{P as q}from"./plus-BqRkXt-R.js";const L=({currentWiki:s})=>{const x=l.useRef(null),{register:c,handleSubmit:d,control:u,reset:r}=T({defaultValues:{currentWiki:s}}),{token:m}=y(),i=C(),h=l.useMemo(()=>({readonly:!1,height:600,uploader:{url:"http://localhost:4000/api/admin/wiki/upload",headers:{Authorization:`Bearer ${m}`},defaultHandlerSuccess:t=>t.file?t.file.url:null,process:t=>({files:[t.file],error:t.error?[t.error]:[]})},toolbarAdaptive:!1,buttons:["source","|","bold","italic","underline","strikethrough","|","ul","ol","|","indent","outdent","|","font","fontsize","brush","paragraph","|","image","file","table","link","|","align","undo","redo","|","hr","eraser","fullsize"],events:{beforeImage:t=>(t.style.maxWidth="100%",t.style.height="auto",t)},style:{color:"#000"}}),[]),o=async t=>{console.log({onsubmit:t});try{const n=s?"PUT":"POST",f=s?`http://localhost:4000/api/admin/wikis/${s.id}`:"http://localhost:4000/api/admin/wikis";(await fetch(f,{method:n,headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify(t)})).status===200&&i("/admin/wikis")}catch(n){console.error("Error saving wiki:",n)}};return l.useEffect(()=>{console.log(s),s&&r({title:s.title,content:s.content,category:s.category})},[s,r]),e.jsx("dialog",{className:"modal",id:"addWikiModal",children:e.jsxs("div",{className:"modal-box w-11/12 max-w-5xl",children:[e.jsxs("form",{onSubmit:d(o),children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Category"}),e.jsxs("select",{...c("category",{required:"Category is required"}),className:"select w-full px-3 py-2 border rounded",children:[e.jsx("option",{value:"quick-start-guite",children:"Quick Start Guide"}),e.jsx("option",{value:"user-manual",children:"User Manual"}),e.jsx("option",{value:"faqs",children:"FAQs"}),e.jsx("option",{value:"solutions",children:"Solutions"}),e.jsx("option",{value:"version-history",children:"Version History"}),e.jsx("option",{value:"useful-links",children:"Useful Link"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Title"}),e.jsx("input",{...c("title",{required:"Title is required"}),className:"w-full px-3 py-2 border rounded",placeholder:"Enter wiki title"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block mb-2",children:"Content"}),e.jsx(A,{name:"content",control:u,rules:{required:"Content is required"},render:({field:{onChange:t,value:n}})=>e.jsx(M,{ref:x,value:n,config:h,onChange:t})})]}),e.jsx("div",{className:"modal-action",children:e.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:[s?"Update":"Create"," Wiki"]})})]}),e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn",children:"Cancel"})})]})})};function O(){const{wikis:s,fetchWikis:x,deleteWiki:c}=y(),[d,u]=l.useState([]),[r,m]=l.useState(""),[i,h]=l.useState("all"),[o,t]=l.useState("all"),[n,f]=l.useState(1),[p]=l.useState(8),b=(s==null?void 0:s.filter(a=>{if(r===""&&i==="all"&&o==="all")return!0;const v=r===""||a.title.toLowerCase().includes(r.toLowerCase()),k=i==="all"||a.type===i,S=o==="all"||a.status===o;return v&&k&&S}))||[],g=n*p,N=g-p,j=b.slice(N,g),w=()=>{u(null),document.getElementById("addWikiModal").showModal()};return l.useEffect(()=>{x(),console.log(d)},[]),e.jsxs("section",{className:"w-full p-6 overflow-y-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 dark:text-gray-100 mb-2",children:"Wiki Management"}),e.jsx("p",{className:"text-slate-600 dark:text-gray-300",children:"Manage ASTER Wikis from here"})]}),e.jsxs("button",{type:"button",onClick:()=>w(),className:"flex items-center justify-center w-1/2 px-5 py-2 text-sm tracking-wide text-white transition-colors duration-200 bg-blue-500 rounded-lg sm:w-auto gap-x-2 hover:bg-blue-600 dark:hover:bg-blue-500 dark:bg-blue-600",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{children:"Add a new Wiki"})]}),e.jsx(L,{currentWiki:d})]})}),e.jsx(E,{setFilterStatus:t,setSearchTerm:m,setFilterType:h,searchTerm:r,filterType:i,filterStatus:o}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Title"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Last Updated"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:j.length>0?j.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.title})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.category})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm text-gray-500",children:new Date(a.updatedAt).toLocaleDateString()})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>{u(a),document.getElementById("addWikiModal").showModal()},className:"text-yellow-600 hover:text-yellow-900 mx-2",children:"Edit"}),e.jsx("button",{onClick:()=>window.open(`/wiki/${a.slug}`,"_blank"),className:"text-blue-600 hover:text-blue-900 mx-2",children:"View"}),e.jsx("button",{onClick:()=>c(a),className:"text-red-600 hover:text-red-900 mx-2",children:"Delete"})]})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-8 text-slate-500",children:r||i!=="all"||o!=="all"?"No wikis match your filters.":"No wikis available. Add some wikis to get started."})})})]})})]})}export{O as default};
